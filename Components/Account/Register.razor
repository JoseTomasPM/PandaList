@page "/register"
@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@inject SignInManager<IdentityUser> SignInManager
@inject NavigationManager Nav

<h3>Register</h3>

@if(error != null)
{
	<p style="color:#ff0000">@error</p>
}

<input @bind="email" placeholder="Email" class="form-control" />
<input @bind="password" placeholder="Password" class="form-control" type="password" />
<input @bind="confirm" placeholder="Confirm Password" class="form-control" type="password" />	

<button class="btn btn-primary" onclick="DoRegister">Register</button>

@code {
    string email;
    string password;
    string confirm;
    string error;

	async Task DoRegister()
	{
		if (password != confirm)
		{
			error = "Passwords do not match";
			return;
		}
		var user = new IdentityUser { UserName = email, Email = email };
		var result = await UserManager.CreateAsync(user, password);
		if (result.Succeeded)
		{
			await SignInManager.SignInAsync(user, isPersistent: false);
			Nav.NavigateTo("/");
		}
		else
		{
			error = "Registration failed: " + string.Join(", ", result.Errors.Select(e => e.Description));
		}
	}
}
